{% extends "base.html" %}

{% block title %}Rankings - {{ weight_class }} lbs{% endblock %}

{% block content %}
<h1>{{ weight_class }} lbs Rankings</h1>

<form method="POST" action="{{ url_for('bulk_delete_wrestlers') }}" id="bulkDeleteForm">

    <!-- Include a hidden field for weight class -->
    <input type="hidden" name="weight_class" value="{{ weight_class }}">

    <!-- Add a "Select All" option at the top -->
    <div class="mb-3">
        <input type="checkbox" id="selectAll" onclick="selectAllWrestlers(this)"> Select All
    </div>

    <!-- Bulk Delete Button at the top for easy access -->
    <button type="submit" class="btn btn-danger mb-3" onclick="return confirm('Are you sure you want to delete the selected wrestlers?')">
        Delete Selected Wrestlers
    </button>

    {% if wrestlers %}
    <table class="table table-striped table-light"> <!-- Lighter table for better readability -->
        <thead class="thead-dark"> <!-- Dark header for contrast -->
            <tr>
                <th>Select</th>
                <th>Rank</th>
                <th>Wrestler</th>
                <th>School</th>
                <th>Wins</th>
                <th>Losses</th>
                <th>Win %</th>
                <th><a href="?sort_by=elo" class="sort-link">Elo Rating</a></th>
                <th><a href="?sort_by=rpi" class="sort-link">RPI</a></th>
                <th><a href="?sort_by=hybrid" class="sort-link">Hybrid Score</a></th>
                <th><a href="?sort_by=dominance" class="sort-link">Dominance Score</a></th>
            </tr>
        </thead>
        <tbody>
            {% for wrestler in wrestlers %}
            <tr class="{% if loop.index is odd %}table-row-light{% else %}table-row-dark{% endif %}">
                <td>
                    <input type="checkbox" name="wrestler_ids[]" value="{{ wrestler.id }}" class="wrestlerCheckbox">
                </td>
                <td>{{ loop.index }}</td>
                <td><a href="{{ url_for('wrestler_detail', wrestler_id=wrestler.id) }}">{{ wrestler.name }}</a></td>
                <td>{{ wrestler.school }}</td>
                <td>{{ wrestler.wins }}</td>
                <td>{{ wrestler.losses }}</td>
                <td>{{ "%.1f"|format(wrestler.win_percentage) }}%</td>
                <td>{{ "%.2f"|format(wrestler.elo_rating) }}</td>  <!-- Elo Rating -->
                <td>{{ "%.3f"|format(wrestler.rpi if wrestler.rpi is not none else 0.000) }}</td>  <!-- RPI -->
                <td>{{ "%.3f"|format(wrestler.hybrid_score if wrestler.hybrid_score is not none else 0) }}</td>  <!-- Hybrid Score -->
                <td>{{ "%.2f"|format(wrestler.dominance_score) }}</td>  <!-- Dominance Score -->
            </tr>
            {% endfor %}
        </tbody>
    </table>
    

    <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete the selected wrestlers?')">
        Delete Selected Wrestlers
    </button>
    {% else %}
        <p>No wrestlers found for this weight class.</p>
    {% endif %}
</form>

<script>
    // Function to select or deselect all checkboxes
    function selectAllWrestlers(source) {
        checkboxes = document.getElementsByClassName('wrestlerCheckbox');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = source.checked;
        }
    }

    // Function to update the "Select All" checkbox based on individual selections
    document.querySelectorAll('.wrestlerCheckbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const allChecked = document.querySelectorAll('.wrestlerCheckbox:checked').length === document.querySelectorAll('.wrestlerCheckbox').length;
            document.getElementById('selectAll').checked = allChecked;
        });
    });
</script>

<!-- Custom styles for table readability -->
<style>
    /* Lighter table background and dark text for readability */
    .table-light {
        background-color: #F8F9FA; /* Light gray background */
        color: #333333; /* Dark gray text */
    }

    .thead-dark th {
        background-color: #343a40; /* Dark header background */
        color: #FFFFFF; /* White text for headers */
    }

    /* Alternating row colors for readability */
    .table-row-light {
        background-color: #FFFFFF; /* White background for light rows */
    }

    .table-row-dark {
        background-color: #f2f2f2; /* Light gray background for alternating rows */
    }

    /* Sort link styles */
    .sort-link {
        color: #007BFF; /* Blue color for the sorting links */
        text-decoration: none;
    }

    .sort-link:hover {
        color: #0056b3; /* Darker blue on hover */
    }
</style>

{% endblock %}
